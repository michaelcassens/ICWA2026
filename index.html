<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ICWA: The Guardian's Path</title>
    <style>
        /* --- VISUAL STYLE: HAND-DRAWN AESTHETIC --- */
        :root {
            --paper-color: #fdfbf7;
            --ink-color: #2b2b2b;
            --accent-green: #8bc34a;
            --accent-red: #e57373;
            --accent-blue: #4fc3f7;
        }

        body {
            background-color: var(--paper-color);
            color: var(--ink-color);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .sketch-box {
            background: white;
            border: 2px solid var(--ink-color);
            border-radius: 2px 255px 3px 25px / 255px 6px 225px 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 2px 3px 0px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }

        h1, h2, h3 {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- BUTTONS --- */
        button {
            background: white;
            border: 2px solid var(--ink-color);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            font-family: inherit;
            font-weight: bold;
            font-size: 1rem;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
            box-shadow: 2px 2px 0px var(--ink-color);
            max-width: 100%;
            white-space: normal; /* Allow text wrapping on buttons */
        }

        button:active {
            transform: translate(2px, 2px);
            box-shadow: none;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-green { border-color: var(--accent-green); color: #2e7d32; }
        .btn-red { border-color: var(--accent-red); color: #c62828; }
        .btn-blue { border-color: var(--accent-blue); color: #0277bd; }

        /* --- FIXED PDF GUIDE BUTTON --- */
        .fixed-guide-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fff;
            border: 3px solid var(--ink-color);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            padding: 15px 20px;
            text-decoration: none;
            color: var(--ink-color);
            font-weight: bold;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s;
        }

        .fixed-guide-btn:hover { transform: scale(1.05); }
        .fixed-guide-btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px rgba(0,0,0,0.2); }

        /* --- FEEDBACK BOXES --- */
        .feedback-box {
            display: none;
            background-color: #f0f0f0;
            margin-top: 15px;
            border: 2px dashed var(--ink-color);
        }
        
        .feedback-correct { border-color: var(--accent-green); background-color: #f1f8e9; }
        .feedback-incorrect { border-color: var(--accent-red); background-color: #ffebee; }

        /* --- SCREENS --- */
        .screen { display: none; }
        .active-screen { display: block; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- MAP SCREEN --- */
        .map-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            text-align: center;
        }
        
        .map-location {
            padding: 20px;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        /* --- BADGES --- */
        .sticker-drawer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            border-top: 2px solid var(--ink-color);
            padding-top: 20px;
            justify-content: center;
        }
        .sticker {
            width: 50px;
            height: 50px;
            border: 2px solid var(--ink-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: #e0e0e0;
            color: #999;
            transition: all 0.5s;
        }
        .unlocked { 
            background: #fffbe0; 
            color: var(--ink-color);
            transform: rotate(-10deg); 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            border-color: #fbc02d;
        }

        /* --- INTRO PULSE --- */
        .pulse-text {
            animation: pulse 2s infinite;
            color: #555;
            font-style: italic;
            text-align: center;
            margin-top: 40px;
            cursor: pointer;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

    </style>
</head>
<body>

    <a href="ICWA 2025 Guidebook Version 1.pdf" target="_blank" class="fixed-guide-btn">
        üìñ Read Guide
    </a>

    <div id="screen-intro" class="screen active-screen">
        <div class="sketch-box" style="text-align: center; padding: 40px 20px;">
            <h1>ICWA Guardian</h1>
            <p>A Guide to Understanding the Indian Child Welfare Act in Montana</p>
            <hr style="border: 1px solid black; width: 50%;">
            <p><i>"Considering the impact of this, take a moment for reflection."</i></p>
            <div style="font-size: 3rem; margin: 20px;">‚õ∞Ô∏è</div>
            
            <div class="pulse-text" onclick="showScreen('screen-map')">
                ( Tap anywhere to Begin )
            </div>
        </div>
        <p style="font-size: 0.8rem; text-align: center;">Based on HB317(2023) & SB147(2025)</p>
    </div>

    <div id="screen-map" class="screen">
        <h2>Montana Information Center</h2>
        <p>Complete all 3 tasks in each location to earn your badges.</p>
        
        <div class="map-container">
            <div class="sketch-box map-location" onclick="startGame('court')">
                üèõÔ∏è<br>Court House
                <div style="font-size:0.8rem; margin-top:5px;">Topic: Active Efforts</div>
            </div>
            
            <div class="sketch-box map-location" onclick="startGame('home')">
                üè†<br>Family Home
                <div style="font-size:0.8rem; margin-top:5px;">Topic: Placements</div>
            </div>

            <div class="sketch-box map-location" onclick="startGame('tribal')">
                ‚õ∫<br>Tribal Gov
                <div style="font-size:0.8rem; margin-top:5px;">Topic: Sovereignty</div>
            </div>
        </div>

        <div class="sticker-drawer">
            <div id="badge-court" class="sticker" title="Evidence Expert">‚öñÔ∏è</div>
            <div id="badge-home" class="sticker" title="Placement Protector">‚ù§Ô∏è</div>
            <div id="badge-tribal" class="sticker" title="Sovereignty Defender">ü™∂</div>
        </div>
    </div>

    <div id="screen-court" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>Active Efforts</h3>
            <button onclick="showScreen('screen-map')" style="font-size:0.8rem;">Exit</button>
        </div>
        <div class="sketch-box">
            <p><b>Mission:</b> Decide if the caseworker's actions count as "Active Efforts" under ICWA. <br><i>(Referrals alone are not enough!)</i></p>
        </div>
        <div id="court-content"></div>
        <div id="court-feedback" class="sketch-box feedback-box"></div>
    </div>

    <div id="screen-home" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>Placement Priority</h3>
            <button onclick="showScreen('screen-map')" style="font-size:0.8rem;">Exit</button>
        </div>
        <div class="sketch-box">
            <p><b>Mission:</b> Select the correct answer regarding Placement Preferences and Bonding.</p>
        </div>
        <div id="home-content"></div>
        <div id="home-feedback" class="sketch-box feedback-box"></div>
    </div>

    <div id="screen-tribal" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>Tribal Sovereignty</h3>
            <button onclick="showScreen('screen-map')" style="font-size:0.8rem;">Exit</button>
        </div>
        <div class="sketch-box">
            <p><b>Mission:</b> Answer questions about Jurisdiction, Membership, and Expert Witnesses.</p>
        </div>
        <div id="tribal-content"></div>
        <div id="tribal-feedback" class="sketch-box feedback-box"></div>
    </div>

    <script>
        // --- GAME STATE ---
        const badges = { court: false, home: false, tribal: false };
        let currentSection = '';
        let currentIndex = 0;
        let currentScore = 0;

        // --- DATA ---
        
        // 1. COURTROOM SCENARIOS (Active Efforts)
        const courtData = [
            {
                text: "The caseworker provided the mother with a list of housing phone numbers but offered no other help.",
                isGood: false,
                reason: "<b>Violation:</b> A referral alone does not constitute an active effort if it was the sole action taken."
            },
            {
                text: "The caseworker offered to assist the parent in completing application paperwork for the service.",
                isGood: true,
                reason: "<b>Correct:</b> Helping with paperwork is an explicit example of Active Efforts."
            },
            {
                text: "The department involved Tribal representatives in the Family Team Meeting.",
                isGood: true,
                reason: "<b>Correct:</b> Involving tribal representatives in family team meetings is required."
            }
        ];

        // 2. PLACEMENT SCENARIOS (Preferences)
        const homeData = [
            {
                question: "Which of these is the FIRST priority for Foster Care placement?",
                options: [
                    { text: "Tribally Approved Institution", correct: false },
                    { text: "Extended Family Member", correct: true },
                    { text: "Non-Relative Indian Foster Home", correct: false }
                ],
                reason: "<b>Correct!</b> Extended family is always the first priority[cite: 395]."
            },
            {
                question: "If Extended Family is unavailable, what is the SECOND priority?",
                options: [
                    { text: "Foster home licensed by the Tribe", correct: true },
                    { text: "State licensed group home", correct: false },
                    { text: "A non-Indian family friend", correct: false }
                ],
                reason: "<b>Correct!</b> A foster home licensed/approved by the Tribe is the second priority[cite: 399]."
            },
            {
                question: "Can a court depart from placement preferences based SOLELY on ordinary bonding with a foster parent?",
                options: [
                    { text: "Yes, bonding is the only factor.", correct: false },
                    { text: "No, bonding cannot be the sole reason.", correct: true }
                ],
                reason: "<b>Correct!</b> Bonding developed from time spent in a non-preferred placement cannot be the sole reason to deviate[cite: 324]."
            }
        ];

        // 3. TRIBAL GOV SCENARIOS (Sovereignty)
        const tribalData = [
            {
                question: "Who has the sole authority to determine if a child is eligible for Tribal membership?",
                options: [
                    { text: "The State Court Judge", correct: false },
                    { text: "The Tribe", correct: true },
                    { text: "The Bureau of Indian Affairs", correct: false }
                ],
                reason: "<b>Correct!</b> Only the Tribe can determine membership or eligibility[cite: 454]."
            },
            {
                question: "Can a state Child Protection Specialist serve as the 'Qualified Expert Witness' (QEW) in their own case?",
                options: [
                    { text: "Yes, if they are senior level.", correct: false },
                    { text: "No, they are prohibited.", correct: true }
                ],
                reason: "<b>Correct!</b> The department specialist cannot serve as the QEW for their own case[cite: 256]."
            },
            {
                question: "If an Indian child lives OFF-reservation, can the case be transferred to Tribal Court?",
                options: [
                    { text: "Yes, absent objection by a parent.", correct: true },
                    { text: "No, only if they live on the reservation.", correct: false }
                ],
                reason: "<b>Correct!</b> The court may transfer jurisdiction absent objection by either parent[cite: 457]."
            }
        ];

        // --- NAVIGATION ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(screenId).classList.add('active-screen');
            updateBadges();
        }

        function updateBadges() {
            if(badges.court) document.getElementById('badge-court').classList.add('unlocked');
            if(badges.home) document.getElementById('badge-home').classList.add('unlocked');
            if(badges.tribal) document.getElementById('badge-tribal').classList.add('unlocked');
        }

        // --- GENERIC GAME LOGIC ---
        function startGame(section) {
            currentSection = section;
            currentIndex = 0;
            currentScore = 0;
            
            // Hide previous feedback
            const feedback = document.getElementById(`${section}-feedback`);
            if(feedback) feedback.style.display = 'none';

            loadQuestion(section);
            showScreen(`screen-${section}`);
        }

        function loadQuestion(section) {
            let container = document.getElementById(`${section}-content`);
            let feedback = document.getElementById(`${section}-feedback`);
            feedback.style.display = 'none';
            
            let dataArr = (section === 'court') ? courtData : (section === 'home' ? homeData : tribalData);

            if (currentIndex >= dataArr.length) {
                showSummary(section, dataArr.length);
                return;
            }

            let item = dataArr[currentIndex];
            let html = `<div class="sketch-box"><p><strong>Question ${currentIndex + 1}/${dataArr.length}:</strong></p>`;

            if (section === 'court') {
                // Yes/No logic for Court
                html += `<p>"${item.text}"</p>
                         <div style="margin-top:20px; text-align:center;">
                            <p>Is this an Active Effort?</p>
                            <button class="btn-green" onclick="handleAnswer('${section}', true)">Yes (üëç)</button>
                            <button class="btn-red" onclick="handleAnswer('${section}', false)">No (üö©)</button>
                         </div></div>`;
            } else {
                // Multiple Choice logic for Home/Tribal
                html += `<p>${item.question}</p><div style="margin-top:20px; text-align:center;">`;
                // Shuffle options
                let opts = [...item.options].sort(() => Math.random() - 0.5);
                opts.forEach(opt => {
                    // escape quotes for function call
                    let safeText = opt.text.replace(/'/g, "\\'"); 
                    html += `<button onclick="handleAnswer('${section}', ${opt.correct})">${opt.text}</button>`;
                });
                html += `</div></div>`;
            }
            
            container.innerHTML = html;
        }

        function handleAnswer(section, userValue) {
            let dataArr = (section === 'court') ? courtData : (section === 'home' ? homeData : tribalData);
            let item = dataArr[currentIndex];
            let isCorrect = false;

            if (section === 'court') {
                isCorrect = (userValue === item.isGood);
            } else {
                isCorrect = userValue; // for multiple choice, userValue is boolean true/false passed from button
            }

            if (isCorrect) currentScore++;

            // Show Feedback
            let feedback = document.getElementById(`${section}-feedback`);
            feedback.style.display = 'block';
            feedback.className = 'sketch-box feedback-box ' + (isCorrect ? 'feedback-correct' : 'feedback-incorrect');
            
            let reasonText = item.reason; 
            // Fallback for home/tribal if reason isn't in main object
            if(!reasonText) reasonText = isCorrect ? "Correct!" : "Incorrect.";

            feedback.innerHTML = `
                <p>${isCorrect ? '‚úÖ' : '‚ùå'} ${reasonText}</p>
                <button onclick="nextQuestion('${section}')">Next ‚ûú</button>
            `;

            // Disable buttons
            let container = document.getElementById(`${section}-content`);
            container.querySelectorAll('button').forEach(b => b.disabled = true);
        }

        function nextQuestion(section) {
            currentIndex++;
            loadQuestion(section);
        }

        function showSummary(section, total) {
            let container = document.getElementById(`${section}-content`);
            // Pass if score is majority (e.g. 2/3 or 3/3)
            let passed = currentScore >= 2; 

            if (passed) badges[section] = true;

            container.innerHTML = `
                <div class="sketch-box" style="text-align:center;">
                    <h3>Section Complete</h3>
                    <p>You scored ${currentScore} out of ${total}</p>
                    ${passed ? '<p style="color:green; font-weight:bold;">Badge Unlocked!</p>' : '<p>Review the Guide and try again!</p>'}
                    <button onclick="showScreen('screen-map')">Return to Map</button>
                </div>
            `;
        }
    </script>
</body>
</html>